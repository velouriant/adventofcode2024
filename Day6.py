import copy

input = """..........#....#..........#......#.......................#...#..........................................#.........................
...................#.........#......#.....#.......................#......................#...#....................................
...........#..#....................................................#..........................#................#......#...........
.....#.#...........................................................................#..........#................#..................
...#..........................................#...........................#....................#..#.........#.....................
...........#.#...#..........#...............#..................#.............#...................................#............#...
......................................................................................................................#..#......#.
....................#..........#.........#.....#.......#....#........................................#..#..........#...........#..
....................#......#...................................................#............................................#.....
..................................................#.........................#...........................#...............#.........
#....#....#..................#.........#..#...................#.........#....#.....#.#........................................#...
...........................................#..............................................................#.......................
#...............................................................................................#...............#...........##....
...#......#.............#...............#.....#........................................#.#........#...........#...#...............
#........#......#............................#.......................#............#...........................#...................
............#................................................#....................................................#...............
.......#.................#......................#.....................#..........#................................................
.......................................................................................#.....#......#.............................
...........................#..#....#.......................#.............................................#...#......#.............
........#........##...#.....................................................#...........................................#.#.......
...............................#.........#......................#...........#..........#.....#...........#.#.................#....
..#.#.............#................................................................................#..................#...........
.....................#.................#............................................#...................#...................#.#.#.
........#...........................................................................................#............##...............
........................................................#........................................................##...............
..#........#.................#...............#......#..........................................#................#.................
..................#......#.............................#.............................#.....................#...#........#........#
....................................#.#.........#..#...............#...............#..............................................
...##..................................................................#....#..............#.#...............................#....
...........#....#...#........#..............................................#.......#.............................................
.................................#.............................#...................................................#..............
..........#.............................#.....#...............#..........................................##...............#.......
...........................................#......##...............#..............#.............................#...#............#
.#.#.....................#........#........................................................#..........#.........#.................
.............#.......................................##..........#.#..........................................................#...
.............#....................................................................................................................
..................##.....#......#........................#......................#........#........................................
.........................................................................................#.....#............#....................#
.#...........#....................................#.#.....................................................#......#...#............
#.#...#....................................................................................#............................##.......#
...#...............#................#...#...#.......................#................................#.#....#.....................
................................#........................................#...................#....................................
...#..#.........#......#......................#..#.....................#..........................................................
.................................................................#.......#........................................#...............
..................................##.......................##........................................#............................
....#....#.............#........................................................#....#.......#....................#..............#
.........##.............................................................#..#.#.....#...........##.................................
....#.........................................#......#.......................#....#..............................#...........#....
.##.....#...........................#........#...................................................#....#...........................
...........................................................#.....#.#...................#......................#......#............
....#............#......................................................#.......#............................................#....
#.......................#..........#.#............................#........#..................................................#...
#....................#.....#......................................................#....................................#.....#....
...#.....#.....#.................#...........#...............................................#....................................
...........................#..........................#............#............#...........................................#.....
.......#.....#..........#........#...................................................................................#........#...
#.....................................#......................................#.............................#......#...............
#.....#....................#.........................................................#................#...........................
.........................................................#....#............#..##.....................#............................
...#..............#.................................#.......#...................................................................#.
............................#........#...........#.......................#.......................#..........#..........#..........
....#..............#.............................................................................#.........#.....#...........#....
..........#................#.........................................#.#..#......................................#...#............
............#...............................................................................................#.#.......#......#..#.
.#................................#...............#.........................#............................................#........
....................................................#.......................#........#........................#.................#.
..###...............#...............#..........................................#.............#...............#..#.#...............
..#...#.......................................#...................................................................#...#...........
..........#..........#..#......#.............................................#......#..................#...................#.....#
.......#.....#.......#.......#.....................................................................................#..........#.#.
#........................#..#......................................................#......#...........#................##.........
....#.....................#...........................................................................#...........................
.......................#..........................#.............................................................................#.
.........#..............#...................#................#.........................#..........#...............................
.........#...........................................................#................................................#......#....
.................#.....#................#.............................................................#...................#......#
....................#.....................................................#...................................................#...
............##.................#...................#................#.......................................................#.....
.........................#............#.#..........................................................................#........#.....
............#.........#........................#..............................................##....#.......................#.....
......#...................................................#..##................^......#...#.......................................
............#.....................................................#..............#.##.....#...............................##......
....................#...................#......#......#......................................................#.....#...#..........
..........................................................................#....#..........#........#..............................
.#.................................................#..............................................................................
.......................#.............................................................#.....#..................#.................#.
...#...............#.#................................#..............................#.....#..#.....#..........#...............#..
...........................................#.............#................................................................#.......
#..............#................................................................................................................#.
..................................#.#................##..............#......#..................#......................#...........
..........#...................................#..................................................#................#............#..
....#.....................#......................#.....#.........#........#................#....#.................................
................................................#......................#.....#....................................................
......#.....#.........................#..........................................................................................#
............................................#..............#.................................#......................#.............
...#......#................................#...............#................................................#.....#...............
#...............#.........................#.#..........................................................#......................#...
..#........#......................#.........#............#...###.........#....................................................#...
............#.....................#........................................#..............#.........#........#....................
...#....#...........................................#.................#...............#.........................#.................
......#........................#..................................................................................................
...#..........................................#....................................................#...........#....##.#.........#
....................#..........................#....#..#...........................................................#..............
.....#...........#.........................#...............#..........................................#..#.#.....................#
................#.......#......#.............................................................#...#................................
...........#....#........##.....................#.....#.....#.....#.........................................................#.....
.#.#.........................#...#......#................................#.......##......#..........#...#..........##.............
...................#...................#......#............................................#...........#.......................#..
..............#.#.................................#.....................................................................#.........
......#............#...................................##....................................#...................#.#..............
......................#.............................#....................................................#...............#........
..........................#.......................................................................#.......##...#..................
...................................................#..............#...#.............#.................#..........#.#....#.........
...#......#....................#..................................................................#...............#......#........
....#......#.#.........#..#..#......#.....................................................#.................#.....#...............
......#..........#............#..............#.......#..................................#.........................................
.##.#.........................#..#.............#..........#.........................................................#.............
.....#..#......................##...........#........................#..#.............................................#...........
.....#...............................#................#...........................................................................
.##....#...................#............#....................................#..............##.............#................##....
....................#......##..............................#...#.................#...............##...#............#..............
.................#...........................#.....................................#.#........#...........#.........#....##.......
......#.............................##....................#......................................................................#
...........#........##...#......#...........#................#.....................................................#..............
......#.#.................................#...........................................................#...#......#........#.#....#
...........#......#....#...............#.......#................#.....................#...........................................
....#......#............................##.#...............##.#..........#.........#........#.................................#...
.#............................#................................#.#..............................................#.....#........#..
.#.#.......#.......#.....................................................................#..............#.................##......
.....#.......................................#.......#........#..............#.........#................#...#...#................."""

map = input.splitlines()
map_orig = copy.deepcopy(map)

loc_x = 79
loc_y = 80
direction = "U"

guard_flags = [["N" for _ in range(130)] for _ in range(130)]
flag_count = 0

def go_up():
    global loc_x, loc_y, direction
    guard_flags[loc_y][loc_x] = "Y"
    if map[loc_y - 1][loc_x] != "#":
        loc_y -= 1
        return None
    else:
        direction = "R"
        return f"{direction},{loc_x},{loc_y}"

def go_right():
    global loc_x, loc_y, direction
    guard_flags[loc_y][loc_x] = "Y"
    if map[loc_y][loc_x + 1] != "#":
        loc_x += 1
        return None
    else:
        direction = "D"
        return f"{direction},{loc_x},{loc_y}"

def go_down():
    global loc_x, loc_y, direction
    guard_flags[loc_y][loc_x] = "Y"
    if map[loc_y + 1][loc_x] != "#":
        loc_y += 1
        return None
    else:
        direction = "L"
        return f"{direction},{loc_x},{loc_y}"

def go_left():
    global loc_x, loc_y, direction
    guard_flags[loc_y][loc_x] = "Y"
    if map[loc_y][loc_x - 1] != "#":
        loc_x -= 1
        return None
    else:
        direction = "U"
        return f"{direction},{loc_x},{loc_y}"

try:
    while 0 <= loc_x <= 129 and 0 <= loc_y <= 129:
        if direction == "U":
            go_up()
        elif direction == "R":
            go_right()
        elif direction == "D":
            go_down()
        elif direction == "L":
            go_left()
except IndexError:
    for line in guard_flags:
        flag_count += line.count("Y")
    print(f"The total number of squares occupied by a guard is {flag_count}")

# Part 2

loops = 0

for i in range(len(map)):
    for j in range(len(map[0])):
        map = copy.deepcopy(map_orig)
        if map[i][j] == ".":
            map[i] = map[i][:j] + "#" + map[i][j+1:]
        loc_x = 79
        loc_y = 80
        direction = "U"
        guard_flags = [["N" for _ in range(130)] for _ in range(130)]
        flag_count = 0
        instructions_list = []

        try:
            while 0 <= loc_x <= 129 and 0 <= loc_y <= 129:
                if direction == "U":
                    new_instruction = go_up()
                elif direction == "R":
                    new_instruction = go_right()
                elif direction == "D":
                    new_instruction = go_down()
                elif direction == "L":
                    new_instruction = go_left()
                if new_instruction != None:
                    if new_instruction in instructions_list:
                        loops += 1
                        print(f"The guard gets stuck in a loop with a new obstacle at {j}, {i}")
                        loc_x = 130
                    elif new_instruction not in instructions_list:
                        instructions_list.append(new_instruction)

        except IndexError:
            for line in guard_flags:
                flag_count += line.count("Y")

print(f"The total number of loops is {loops}")

